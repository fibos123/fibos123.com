"use strict";angular.module("appApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/monitor",{templateUrl:"views/monitor.html",controller:"MonitorCtrl",controllerAs:"monitor"}).when("/monitor/pointer",{templateUrl:"views/monitor_pointer.html",controller:"MonitorPointerCtrl",controllerAs:"monitorpointer"}).when("/monitor/logs",{templateUrl:"views/monitor_logs.html",controller:"MonitorLogsCtrl",controllerAs:"monitorlogs"}).otherwise({redirectTo:"/"})}]),angular.module("appApp").controller("HeaderCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path().slice(1).split("/")[0]},a.menuItems=[{name:"网站",icon:"fas fa-map-signs",url:""},{name:"节点监控",icon:"fab fa-connectdevelop",url:"monitor"}]}]),angular.module("appApp").controller("MainCtrl",["$scope",function(a){function b(){var a="https://api.fibos123.com/json2jsonp?url="+encodeURIComponent("https://fibos.io/getExchangeInfo?rand="+Math.random())+"&callback=?";$.getJSON(a,function(a){c=a.price,d=1/a.price,setTimeout(b,5e3)})}document.title="FIBOS 导航",$.getJSON("data.json?rand="+Math.random(),function(b){a.data=b,a.$apply(),AOS.init({startEvent:"aosEvent",disable:"mobile",once:!0,offset:60}),document.dispatchEvent(new Event("aosEvent"))});var c,d,e=0;b();var f=setInterval(function(){c&&(e%2===0?document.title=c+" FO / EOS | FIBOS 导航":document.title=d.toFixed(6)+" EOS / FO | FIBOS 导航",e++)},3e3);a.$on("$destroy",function(){clearInterval(f)})}]),angular.module("appApp").controller("MonitorCtrl",["$scope",function(a){function b(){$.getJSON("https://api.fibos123.com/bp_status",function(e){a.bp_status=e,d&&JSON.stringify(d)==JSON.stringify(e.rows2)||(a.bp_status_rows=e.rows2,d=e.rows2),a.$apply(),c=setTimeout(function(){b()},1e3)})}document.title=" 节点监控 | FIBOS 导航";var c,d={};b(),a.$on("$destroy",function(){clearTimeout(c)})}]),angular.module("appApp").controller("MonitorLogsCtrl",["$scope",function(a){function b(){d={},$.getJSON("https://api.fibos123.com/bp_status_change_logs",function(b){a.bp_status_change_logs=b,d&&d.length==b.rows.length||(a.bp_status_change_logs_rows=b.rows,d=b.rows),a.$apply()})}document.title=" 节点监控 | FIBOS 导航";var c,d=[],e=!1;b(),a.refresh=b,a.is_all=e,a.show_all=function(){a.is_all=!0},a.$on("$destroy",function(){clearTimeout(c)})}]),angular.module("appApp").controller("MonitorPointerCtrl",["$scope",function(a){function b(){function b(a,b,c,d){$.ajax({type:"GET",timeout:1e3,url:b,data:{},dataType:"json",success:function(d,e){c(a,b,d)},error:function(c,e,f){d(a,b,e)}})}function c(a,b,c,d,e){var f="https://api.fibos123.com/json2jsonp?url="+encodeURIComponent("https://networkappers.com/api/port.php?ip="+b+"&port="+c)+"&callback=?";$.ajax({type:"GET",timeout:2e3,url:f,data:{},dataType:"json",success:function(e,f){d(a,b,c,e)},error:function(d,f,g){e(a,b,c,f)}})}d={},$.post("https://rpc-mainnet.fibos123.com/v1/chain/get_table_rows",JSON.stringify({json:"true",code:"producerjson",scope:"producerjson",table:"producerjson",limit:1e3}),function(e){for(var f={},g=0;g<e.rows.length;g++){var h=JSON.parse(e.rows[g].json);f[g]={owner:e.rows[g].owner,http_status:"unset",http_number:"",https_status:"unset",https_number:"",p2p_status:"unset"},d[g]||(d[g]={owner:e.rows[g].owner,http_status:"unset",http_number:"",http_msg:"",https_status:"unset",https_number:"",https_msg:"",p2p_status:"unset"});for(var i=0;i<h.nodes.length;i++){var j=h.nodes[i].api_endpoint||h.nodes[i].rpc_endpoint;j&&(d[g].http_status&&(f[g].http_status=d[g].http_status,f[g].http_number=d[g].http_number,f[g].http_msg=d[g].http_msg),0===j.indexOf("http://")?b(g,j+"/v1/chain/get_info",function(a,b,c){c&&c.head_block_num?(f[a].http_status=d[a].http_status="online",f[a].http_number=d[a].http_number=c.head_block_num):f[a].http_status=d[a].http_status="offline"},function(a,c,e){if("timeout"==e)f[a].http_status=d[a].http_status="timeout";else{var c="https://api.fibos123.com/json2jsonp?url="+encodeURIComponent(c)+"&callback=?";b(a,c,function(a,b,c){c&&c.head_block_num?(f[a].http_status=d[a].http_status="warning",f[a].http_number=d[a].http_number=c.head_block_num):f[a].http_status=d[a].http_status="offline"},function(a,b,c){f[a].http_status=d[a].http_status="error",f[a].http_msg=d[a].http_msg="error"})}}):(f[g].http_status=d[g].http_status="error",f[g].http_msg=d[g].http_msg="not http"),f[g].http_endpoint=d[g].http_endpoint=j);var k=h.nodes[i].ssl_endpoint;k&&(d[g].https_status&&(f[g].https_status=d[g].https_status,f[g].https_number=d[g].https_number,f[g].https_msg=d[g].https_msg),0===k.indexOf("https://")?b(g,k+"/v1/chain/get_info",function(a,b,c){c&&c.head_block_num?(f[a].https_status=d[a].https_status="online",f[a].https_number=d[a].https_number=c.head_block_num):f[a].https_status=d[a].https_status="offline"},function(a,c,e){if("timeout"==e)f[a].https_status=d[a].https_status="timeout";else{var c="https://api.fibos123.com/json2jsonp?url="+encodeURIComponent(c)+"&callback=?";b(a,c,function(a,b,c){c&&c.head_block_num?(f[a].https_status=d[a].https_status="warning",f[a].https_number=d[a].https_number=c.head_block_num):f[a].https_status=d[a].https_status="offline"},function(a,b,c){f[a].https_status=d[a].https_status="error",f[a].https_msg=d[a].https_msg="error"})}}):(f[g].https_status=d[g].https_status="error",f[g].https_msg=d[g].https_msg="not https"),f[g].https_endpoint=d[g].https_endpoint=k);var l=h.nodes[i].p2p_endpoint;if(l){if(d[g].p2p_status&&"unset"!=d[g].p2p_status)f[g].p2p_status=d[g].p2p_status;else{var m=l.split(":"),n=m[0],o=m[1];d[g].p2p_status="connecting",c(g,n,o,function(a,b,c,e){var g=e&&e.msg;g&&e.msg.indexOf("open")?f[a].p2p_status=d[a].p2p_status="open":g&&e.msg.indexOf("blocked")?f[a].p2p_status=d[a].p2p_status="blocked":f[a].p2p_status=d[a].p2p_status="timeout"},function(a){f[a].p2p_status=d[a].p2p_status="timeout"})}f[g].p2p_endpoint=d[g].p2p_endpoint=l}}}a.producerjson=f,a.$apply(),$('[data-toggle="tooltip"]').tooltip()})}document.title=" 节点监控 | FIBOS 导航";var c,d={};"https:"===window.location.protocol&&(window.location.href="http:"+window.location.href.substring(window.location.protocol.length)),b(),a.refresh=b;var e=setInterval(function(){a.$apply(),$('[data-toggle="tooltip"]').tooltip()},100);a.$on("$destroy",function(){clearTimeout(c),clearInterval(e)})}]),angular.module("appApp").run(["$templateCache",function(a){a.put("views/main.html",'<main role="main"> <section class="jumbotron text-center"> <div class="bg"></div> <div class="container"> <h1 class="jumbotron-heading">FIBOS 导航</h1> <p class="lead"> 一个汇集 FIBOS 优质网址及资源的导航网站 </p> </div> </section> <div class="album py-5 bg-light"> <div id="content" class="container"> <section ng-repeat="value in data"> <div class="panel-heading"><a id="{{ value.name }}" data-aos="fade-up"> <i class="{{ value.icon }}"></i> {{ value.name }}</a> </div> <content ng-repeat="value in value.sub" data-aos="fade-up" ng-class="{ line1: value.child.length <= 5 }"> <header ng-if="value.name"> <h2 class="icon-download"><a id="{{ value.name }}"><i ng-if="value.icon" class="{{ value.icon }}"></i> {{ value.name }}</a></h2> </header> <ul class="website-list"> <li ng-repeat="value in value.child"> <a href="{{ value.url }}" class="website" target="_blank"> <p class="name"><i ng-if="value.icon" class="{{ value.icon }}"></i> {{ value.name }}</p> <p class="description">{{ value.desc }}</p> </a> <p class="more" ng-if="value.more"> <a href="{{ value.more.url }}" target="_blank" class="{{ value.more.color }}"> <i ng-if="value.more.icon" class="{{ value.more.icon }}"></i> {{ value.more.name }} </a> </p> </li> </ul> </content> </section> </div> </div> </main>'),a.put("views/monitor.html",'<main role="main"> <div class="album py-4 bg-light"> <div id="content" class="container"> <ul class="nav nav-pills flex-column flex-sm-row"> <li class="nav-item"> <a class="nav-link active" ng-href="#!/monitor">出块节点在线状态</a> </li> <li class="nav-item"> <a class="nav-link" ng-href="#!/monitor/logs">出块节点在线状态变更记录</a> </li> <li class="nav-item"> <a class="nav-link" ng-href="#!/monitor/pointer">接入点状态监测</a> </li> </ul><br> <h3>出块节点在线状态</h3> <div ng-if="bp_status"> 最新区块：{{ bp_status.head_block_num | number }}<br> 状态更新时间：{{ bp_status.bp_status_refresh_time | date : "yyyy-MM-dd HH:mm:ss Z" }} </div> <table ng-if="bp_status_rows" class="table table-bordered table-hover table-sm table-striped monospaced-font"> <thead> <tr> <th width="50" class="text-center">编号</th> <th>节点账户</th> <th width="20%">状态</th> <th width="20%">打包区块</th> <th width="35%">最终打包时间</th> </tr> </thead> <tbody> <tr ng-repeat="(key, value) in bp_status_rows" ng-class="{ \'font-weight-bold\': bp_status.head_block_producer == value.bpname }"> <td align="center">{{ $index + 1 }}</td> <td>{{ value.bpname }}</td> <td class="{{ value.status }}"> {{ value.status }} </td> <td> {{ value.number | number }} </td> <td> {{ value.date | date : "yyyy-MM-dd HH:mm:ss Z" }} </td> </tr> </tbody> </table> <div ng-if="!bp_status">获取中...</div> </div> </div> </main>'),a.put("views/monitor_logs.html",'<main role="main"> <div class="album py-4 bg-light"> <div id="content" class="container"> <ul class="nav nav-pills flex-column flex-sm-row"> <li class="nav-item"> <a class="nav-link" ng-href="#!/monitor">出块节点在线状态</a> </li> <li class="nav-item"> <a class="nav-link active" ng-href="#!/monitor/logs">出块节点在线状态变更记录</a> </li> <li class="nav-item"> <a class="nav-link" ng-href="#!/monitor/pointer">接入点状态监测</a> </li> </ul><br> <div class="d-flex justify-content-between"> <div> <h3>出块节点在线状态变更记录 </h3> <div ng-if="bp_status_change_logs"> 记录开始时间：{{ bp_status_change_logs.log_birthtime | date : "yyyy-MM-dd HH:mm:ss Z" }} <br> 记录更新时间：{{ bp_status_change_logs.now_time | date : "yyyy-MM-dd HH:mm:ss Z" }} </div> </div> <div class="mt-auto"> <a class="a-link" ng-click="refresh()"><i class="fas fa-sync-alt"></i> 刷新</a> </div> </div> <table ng-if="bp_status_change_logs_rows" class="table table-bordered table-hover table-sm table-striped monospaced-font"> <thead> <tr><th width="50" class="text-center">编号</th><th>时间</th><th>节点账户</th><th>旧状态</th><th>新状态</th></tr> </thead> <tbody> <tr ng-repeat="(key, value) in bp_status_change_logs_rows.slice().reverse()" ng-if="$index < 20 || is_all"> <td align="center">{{ bp_status_change_logs_rows.length - $index }}</td> <td>{{ value.date | date : "yyyy-MM-dd HH:mm:ss Z" }}</td> <td>{{ value.bp }}</td> <td class="{{ value.from }}">{{ value.from }}</td> <td class="{{ value.to }}">{{ value.to }}</td> </tr> </tbody> </table> <a class="a-link" ng-click="show_all()" ng-if="!is_all && bp_status_change_logs"> 查看剩余的 {{ bp_status_change_logs_rows.length - 20 }} 条记录 </a> <div ng-if="!bp_status_change_logs">获取中...</div> </div> </div> </main>'),a.put("views/monitor_pointer.html",'<main role="main"> <div class="album py-4 bg-light"> <div id="content" class="container"> <ul class="nav nav-pills flex-column flex-sm-row"> <li class="nav-item"> <a class="nav-link" ng-href="#!/monitor">出块节点在线状态</a> </li> <li class="nav-item"> <a class="nav-link" ng-href="#!/monitor/logs">出块节点在线状态变更记录</a> </li> <li class="nav-item"> <a class="nav-link active" ng-href="#!/monitor/pointer">接入点状态监测</a> </li> </ul><br> <div class="d-flex justify-content-between"> <div><h3>接入点状态监测 </h3></div> <div class="mt-auto"> <a class="a-link" ng-click="refresh()"><i class="fas fa-sync-alt"></i> 刷新</a> </div> </div> <table ng-if="producerjson" class="table table-bordered table-hover table-sm table-striped monospaced-font"> <thead> <tr> <th width="50" class="text-center">编号</th> <th>节点账户</th> <th width="25%">HTTP 状态 </th> <th width="25%">HTTPS 状态</th> <th width="25%">P2P 状态 <span data-toggle="tooltip" title="检查是否开放端口"> <i class="far fa-question-circle"></i> </span> </th> </tr> </thead> <tbody> <tr ng-repeat="(key, value) in producerjson"> <td align="center">{{ $index + 1 }}</td> <td>{{ value.owner }}</td> <td class="{{ value.http_status }}"> <span data-toggle="tooltip" title="{{ value.http_endpoint }}"> <span ng-if="value.http_status == \'online\'">{{ value.http_number | number }}</span> <span ng-if="value.http_status == \'warning\'">{{ value.http_number | number }} </span> <span ng-if="value.http_status == \'unset\'">unset</span> <span ng-if="value.http_status == \'offline\'">offline</span> <span ng-if="value.http_status == \'timeout\'">timeout</span> <span ng-if="value.http_status == \'error\'">{{ value.http_msg }}</span> </span> <span ng-if="value.http_status == \'warning\'" data-toggle="tooltip" title="未开启 CORS"> <i class="far fa-question-circle"></i> </span> </td> <td class="{{ value.https_status }}"> <span data-toggle="tooltip" title="{{ value.https_endpoint }}"> <span ng-if="value.https_status == \'online\'">{{ value.https_number | number }}</span> <span ng-if="value.https_status == \'warning\'">{{ value.https_number | number }}</span> <span ng-if="value.https_status == \'unset\'">unset</span> <span ng-if="value.https_status == \'offline\'">offline</span> <span ng-if="value.https_status == \'timeout\'">timeout</span> <span ng-if="value.https_status == \'error\'">{{ value.https_msg }}</span> </span> <span ng-if="value.https_status == \'warning\'" data-toggle="tooltip" title="未开启 CORS"> <i class="far fa-question-circle"></i> </span> </td> <td class="{{ value.p2p_status }}"> <span data-toggle="tooltip" title="{{ value.p2p_endpoint }}"> {{ value.p2p_status }} </span> </td> </tr> </tbody> </table> <div ng-if="!producerjson">获取中...</div> </div> </div> </main>')}]);